generator client {
  provider = "prisma-client-js"
  output   = "../packages/platform/prisma-client"
}

datasource db {
  provider = "sqlite"
  url      = "file:../.data/dev.db"
}

model User {
  id           String        @id @default(cuid())
  email        String        @unique
  displayName  String
  passwordHash String
  isActive     Boolean       @default(true)
  failedLogins Int           @default(0)
  lockedUntil  DateTime?
  role         Role          @relation(fields: [roleId], references: [id])
  roleId       String
  sessions     UserSession[]
  tasks        UserTaskLog[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model Role {
  id       String @id @default(cuid())
  name     String @unique
  policies String
  users    User[]
}

model UserSession {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  deviceId  String
  tokenHash String
  expiresAt DateTime
  createdAt DateTime @default(now())
}

model UserTaskLog {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  action    String
  payload   String
  createdAt DateTime @default(now())
}

model Branch {
  id    String @id @default(cuid())
  code  String @unique
  name  String
  items Item[]
}

model Item {
  id              String   @id @default(cuid())
  sku             String?  @unique
  title           String
  category        String
  metal           String
  karat           String
  weight_g        Float
  stone_desc      String?
  cert_no         String?
  condition       String
  currentState    String
  currentBranchId String?
  branch          Branch?  @relation(fields: [currentBranchId], references: [id])
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}
